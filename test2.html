<!DOCTYPE html>
<html>

<head>
    <title>Tasks</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html" ; charset="utf-8">
    <style type="text/css">
    </style>
</head>

<body onload="init()">
    <a href="./">Main Page</a><br>
    You are using, andrew_ormanzhi@mail.ru as your e-mail adress. <div class="container">
        <div class="my-5 mx-auto text-center">
            <!--<button class="btn btn-dark btn-lg" data-toggle="modal" data-target="#exampleModal">Открыть модальное окно</button>-->
            <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#exampleModal">Open!</button>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" role="dialog">
        <!-- Modal 
        <button name="stopButton'.$t["id"].'" type="button" class="btn btn-info btn-sm">Stop</button></td>-->
        <!--<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" > -->
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Create new task</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="contactForm" action="./tasks" method="post">
                        <div class="form-group">
                            <label for="prname">ProjectName:</label>
                            <input id="prname" class="form-control" name="prname" type="text" placeholder="Project name" value="">
                        </div>
                        <div class="form-group">
                            <label for="tname">Task:</label>
                            <input id="tname" class="form-control" name="tname" required type="text" placeholder="Task name" value="">
                        </div>
                        <div class="form-group">
                            <label for="tdesc">Task description:</label>
                            <textarea id="tdesc" class="form-control" name="tdesc" rows="4" placeholder="Optional" value=""></textarea>
                        </div>
                        <div class="form-group form-check">
                            <input id="check" class="form-check-input" name="check" type="checkbox">
                            <label class="form-check-label" for="check">Start tracking after creation.</label>
                        </div>
                        <button id="button" class="btn btn-success btn-block" name="submit" type="submit">Create task!</button>
                        <div class="result">
                            <span id="answer"></span>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    1553959747<br />17:29:07<div class="container">
        <h6>Current tasks of user @andrew_ormanzhi@mail.ru</h6>
        <table class="table">
            <thead>
                <tr>
                    <th>Projectname</th>
                    <th>Taskname</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Time used</th>
                    <th>Time resume</th>
                    <th>Control</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Diplom</td>
                    <td>1st</td>
                    <td>check</td>
                    <td class="tasks_status">Stopped</td>
                    <td><span class="tasks_time" id="task_id_1">71:11:39</span></td>
                    <td>1553703448</td>
                    <td><button name="startButton1" type="button" class="ctrl_btn btn btn-info btn-sm">Continue</button>
                </tr>
                <tr>
                    <td>edgdg</td>
                    <td>dfd</td>
                    <td></td>
                    <td class="tasks_status">Stopped</td>
                    <td><span class="tasks_time" id="task_id_2">25:52:17</span></td>
                    <td>1553866610</td>
                    <td><button name="startButton2" type="button" class="ctrl_btn btn btn-info btn-sm">Continue</button>
                </tr>
                <tr>
                    <td>common</td>
                    <td>fgfg</td>
                    <td></td>
                    <td class="tasks_status">Running</td>
                    <td><span class="tasks_time" id="task_id_3">25:51:19</span></td>
                    <td>1553866668</td>
                    <td><button name="startButton3" type="button" class="ctrl_btn btn btn-info btn-sm">Stop</button>
                </tr>
            </tbody>
        </table>
        <div><button name="stopButton" type="button" class="btn btn-info btn-lg" onclick="stopTasks();">Stop</button></td>
        </div>
    </div> <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
    window.jQuery || document.write('<script src="./libs/jquery-3.3.1.min.js"></body\/script>')
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
<script type="text/javascript">
let counters = [];
let intervals = [];

function init() {
    let ctrlBtns = document.getElementsByClassName("ctrl_btn");
    let timers = document.getElementsByClassName("tasks_time");
    for (let i = 0; i < ctrlBtns.length; i++) {
        ctrlBtns[i].addEventListener('click', () => {
            try {
                if (ctrlBtns[i].innerHTML === "Continue") {
                    ctrlBtns[i].innerHTML = "Stop";
                    let status = document.getElementsByClassName('tasks_status');
                    status[i].innerHTML = "Running";
                } else {
                    ctrlBtns[i].innerHTML = "Continue";
                    let status = document.getElementsByClassName('tasks_status');
                    status[i].innerHTML = "Stopped";
                }
            } catch (e) {
                console.log(e);
            }
        });
    }
}

function timer(string) {
    var a = string.split(':');
    a[2] = Number(a[2]);
    a[1] = Number(a[1]);
    a[0] = Number(a[0]);
    if (a[2] >= 59) {
        a[2] = 0;
        if (a[1] >= 59) {
            a[1] = 0;
            a[0]++;
        } else { a[1]++; }
    } else { a[2] += 1; }
    a[2] = ((a[2] < 10) ? "0" : "") + a[2];
    a[1] = ((a[1] < 10) ? "0" : "") + a[1];
    a[0] = (a[0] == 0) ? "0" : a[0];
    var b = a[0] + ":" + a[1] + ":" + a[2];
    return b;
}
setInterval(() => {
    let status = document.getElementsByClassName('tasks_status');
    let timers = document.getElementsByClassName("tasks_time");

    for (var i = 0; i < status.length; i++) {
        if (status[i].innerHTML == "Running") {
            timers[i].innerHTML = timer(timers[i].innerHTML);
        }
    }
}, 1000);

function stopTasks() {
    let status = document.getElementsByClassName("tasks_status");
    let ctrlBtns = document.getElementsByClassName("ctrl_btn");
    for (i = 0; i < status.length; i++) {
        status[i].innerHTML = "Stopped";
        ctrlBtns[i].innerHTML = "Continue";
    }
}

// setTimer();
// function tick(id) {
//     // body...
//     let time = document.getElementsByClassName("tasks_time");
//     time[id].innerHTML = timer(time[id].innerHTML);
// }
// function setTimer() {
//     try {
//         let status = document.getElementsByClassName("tasks_status");
//         //let ctrlBtns = document.getElementsByClassName("ctrl_btn");
//         console.log('Status of tasks:');
//         for (let index = 0; index < status.length; index++) {
//             //startTimer(index);
//             console.log('setTimer for task' + index);
//             if (status[index].innerHTML === 'Running') {
//                 console.log("task " + index + " is running");
//                 if (intervals[index]) {
//                     clearInterval(intervals[index]);
//                 }
//                 intervals[index] = setInterval("tick(index)", 1000);
//             }
//         }
//     } catch (error) {
//         console.log("setCtrlButEvents error: ", error);
//     }
// }
//  if (intervalId[id - 1]) {
//         clearInterval(intervalId[id - 1]);
//     }
</script>

</html>